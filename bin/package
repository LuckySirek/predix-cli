#!/bin/bash

set -e

TAR=tar
if [ "$(uname)" == "Darwin" ]; then
  if ! gtar_path=$(type -p gtar); then
    echo "Install GNU Tar on Mac to create a linux compatible Tar (https://www.gnu.org/software/tar)"
    echo "If you have brew installed, run 'brew install gnu-tar'"
    exit 1
  fi
  TAR=gtar
fi

ROOT_DIR=$(cd "$(dirname $0)/.." && pwd)

pushd "$ROOT_DIR" >/dev/null
  rm -rf package

  bin/build

  mkdir package

  cp -r out package/bin
  cp -r bin/autocomplete package/autocomplete
  cp bin/install package/install

  pushd package >/dev/null
    $TAR -cvzf predix-cli.tar.gz bin/* autocomplete/* install
  popd >/dev/null
popd >/dev/null
